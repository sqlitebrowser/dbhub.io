[[ define "usagePage" ]]
<!doctype html>
<html ng-app="DBHub" ng-controller="prefView">
[[ template "head" . ]]
<body>
<script src="/js/plotly-basic-2.18.2.min.js"></script>
[[ template "header" . ]]
<div>
    <div class="row">
        <div class="col-md-1">
            &nbsp;
        </div>
        <div class="col-md-10">
            <h2 style="text-align: center;">Your usage</h2>

            <!--<div class="btn-group">-->
            <!--    <label class="btn btn-default" ng-model="showCharts" ng-click="chartClick('true')" uib-btn-radio="'true'" data-cy="textbtn">Charts</label>-->
            <!--    <label class="btn btn-default" ng-model="showCharts" ng-click="chartClick('false')" uib-btn-radio="'false'" data-cy="chartbtn">Text</label>-->
            <!--</div>-->

            <div>
                <div id="visdiskhist" style="width:100%;"></div>
                <div id="visdiskrec" style="width:100%;"></div>

                <div id="visuploadshist" style="width:100%;"></div>
            </div>


            <h3 style="text-align: center;">Number of standard databases over time</h3>
            <div id="visnumstd" style="width:100%;"></div>

            <h3 style="text-align: center;">Number of live databases over time</h3>
            <div id="visnumlive" style="width:100%;"></div>

            <!--
                What else would be useful to display here?

                * Probably most/all other stat info we collect

                  * Number of databases
                  * API calls
                    * Show each operation type as a separate bar/line
                  * Database uploads/downloads
                    * Show each source as a separate bar/line; webui, api, db4s
                  * Visualisations
                    * Number of visualisations
                    * Number of calls to the visualisations?
             -->

        </div>
        <div class="col-md-1">
            &nbsp;
        </div>
    </div>
</div>
[[ template "footer" . ]]
<script>
    // Historical disk usage
    let plotDataDiskStdHist = {
        x: [[ .DiskDatesHistorical ]],
        y: [[ .DiskStdHistorical ]],
        type: 'bar',
        name: 'Standard databases'
    };
    let plotDataDiskLiveHist = {
        x: [[ .DiskDatesHistorical ]],
        y: [[ .DiskLiveHistorical ]],
        type: 'bar',
        name: 'Live databases'
    };
    let plotDataDiskHist = [plotDataDiskStdHist, plotDataDiskLiveHist];
    let plotLayoutDiskHist = {
        title: 'Historical disk space usage',
        showlegend: true,
        xaxis: {
            title: 'Date',
            showgrid: false,
            zeroline: false
        },
        yaxis: {
            title: 'Megabytes',
            showline: true
        }
    };

    // Recent disk usage
    let plotDataDiskStdRec = {
        x: [[ .DiskDatesRecent ]],
        y: [[ .DiskStdRecent ]],
        type: 'bar',
        name: 'Standard databases'
    };
    let plotDataDiskLiveRec = {
        x: [[ .DiskDatesRecent ]],
        y: [[ .DiskLiveRecent ]],
        type: 'bar',
        name: 'Live databases'
    };
    let plotDataDiskRec = [plotDataDiskStdRec, plotDataDiskLiveRec];
    let plotLayoutDiskRec = {
        title: 'Recent disk space usage',
        showlegend: true,
        xaxis: {
            title: 'Date',
            showgrid: false,
            zeroline: false
        },
        yaxis: {
            title: 'Megabytes',
            showline: true
        }
    };

    // Historical upload numbers
    let plotUploadsAPIHist = {
        x: [[ .UploadDatesHistorical ]],
        y: [[ .UploadApiHistorical ]],
        type: 'bar',
        name: 'Uploads through API'
    };
    let plotUploadsDB4SHist = {
        x: [[ .UploadDatesHistorical ]],
        y: [[ .UploadDB4SHistorical ]],
        type: 'bar',
        name: 'Uploads through DB4S'
    };
    let plotUploadsWebuiHist = {
        x: [[ .UploadDatesHistorical ]],
        y: [[ .UploadWebuiHistorical ]],
        type: 'bar',
        name: 'Uploads through Website'
    };
    let plotUploadsHist = [plotUploadsAPIHist, plotUploadsDB4SHist, plotUploadsWebuiHist];
    let plotLayoutUploadsHist = {
        title: 'Historical upload numbers',
        showlegend: true,
        xaxis: {
            title: 'Date',
            showgrid: false,
            zeroline: false
        },
        yaxis: {
            title: 'Uploads',
            showline: true
        }
    };

    let plotConfig = {
        displaylogo: false,
        editable: true,
        responsive: false, // Responsive mode badly screws things up in Firefox.  Better to handle resize events ourselves.
        watermark: false,
    };

    // * AngularJS *
    let app = angular.module('DBHub', ['ui.bootstrap', 'ngSanitize']);
    app.controller('prefView', function($scope, $http, $httpParamSerializerJQLike) {

        // Display usage as charts or text?
        $scope.showCharts = "true";
        $scope.chartClick = function(newValue) {
            console.log("New incoming value = " + newValue);
            if (newValue === "true") {
                $scope.showCharts = "true";
            } else {
                $scope.showCharts = "false";
            }
            console.log("showCharts = " + $scope.showCharts);
        };
        $scope.chartClick($scope.showCharts);

        // Draw the charts
        if ($scope.showCharts === "true") {
            Plotly.newPlot('visdiskhist', plotDataDiskHist, plotLayoutDiskHist);
            Plotly.newPlot('visdiskrec', plotDataDiskRec, plotLayoutDiskRec);
            Plotly.newPlot('visuploadshist', plotUploadsHist, plotLayoutUploadsHist);
        }
    });
</script>
</body>
</html>
[[ end ]]
